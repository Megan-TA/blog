---
title: 移动端遇到问题汇总
catalog: true
date: 2020-09-28 15:08:28
subtitle:
header-img:
tags: javascript
---

1. 弹窗滚动穿透
引用`tua-body-scroll-lock`第三方包处理，可解决ios、android、h5、pc多端滚动穿透问题，如果已被禁用的元素需要滚动，可以设置`point-events: auto;`
2. ios safria浏览器下页面设置了动态动画暂停状态，回退时重新触发了css3动画；

测试下来，ios下的页面回退时，会走跨页面间的缓存回到页面离开时的状态，暂时没看到能保持css3动画最终状态设置，导致表现形式和android不一致

曲线救国方案，监听在ios下页面回退时触发`onpageshow`方式，强制进行更新

```javascript
// 方法1：
window.addEventListener('pageshow', () => {
  if (e.persisted || (window.performance &&
    window.performance.navigation.type == 2)) {
    location.reload()
  }
}, false);

// 方法2:
window.history.replaceState(null, '', window.location.href + '?timestamp=' + new Date().getTime());
```

onpageshow每次页面加载都会触发,无论是从缓存中加载还是正常加载,这是他和onload的区别;persisted判断页面是否从缓存中读出

页面通过历史记录和前进后退访问时。type值为2
