---
title: 前端http与https问题整理
catalog: true
date: 2020-03-17 10:37:17
subtitle:
header-img:
tags: http
categories: 前端
---

## TCP 特性

- 单工通信
- 并非 100%可靠协议，仅保证尽可能会把数据传送给接收方
- 使用校验和，确认和重传机制来保证可靠传输
- 通过滑动窗口来实现流量控制，通过动态改变窗口大小进行阻塞控制。

## TCP滑动窗口协议的意义

1. 可靠性，滑动窗口只有在队列前部被确认之后才会往后移动，保证数据包被接收方确认并接收；
2. 传输效率，假如没有窗口，服务端是杂乱无章的进行发包，因为TCP的队首效应，如果有前面的包没有发送成功，就会不停重试，反而造成更差的传输效率；
3. 稳定性，TCP滑动窗口大小，是整个复杂网络商榷的结果，会进行动态调整，可以尽量的避免网络拥塞，更加稳定。

## TCP 三次握手和四次挥手的理解

![示意图](https://user-images.githubusercontent.com/34148615/53062591-3d846300-34fc-11e9-8d0f-4063d9ff3398.png)

TCP 三次握手：

三次握手的目的是连接服务器指定端口，建立 TCP 连接，并同步连接双方的序列号和确认号，交换 TCP 窗口大小信息。

其中，为了保证后续的握手是为了应答上一个握手，每次握手都会带一个标识 seq，后续的 ACK 都会对这个 seq 进行加一来进行确认

三次握手之所以是三次是保证 client 和 server 均让对方知道自己的接收和发送能力没问题而保证的最小次数，三次是最少的安全次数，两次不安全，四次浪费资源。

完整流程如下：

- 第一次握手(SYN=1, seq=x):

客户端发送一个 TCP 的 SYN 标志位置 1 的包，指明客户端打算连接的服务器的端口，以及初始序号 X,保存在包头的序列号(Sequence Number)字段里。

发送完毕后，客户端进入 SYN_SEND 状态。

- 第二次握手(SYN=1, ACK=1, seq=y, ACKnum=x+1):

服务器发回确认包(ACK)应答。即 SYN 标志位和 ACK 标志位均为 1。服务器端选择自己 ISN 序列号，放到 Seq 域里，同时将确认序号(Acknowledgement Number)设置为客户的 ISN 加 1，即 X+1。 发送完毕后，服务器端进入 SYN_RCVD 状态。

- 第三次握手(ACK=1，ACKnum=y+1)

客户端再次发送确认包(ACK)，SYN 标志位为 0，ACK 标志位为 1，并且把服务器发来 ACK 的序号字段+1，放在确定字段中发送给对方，并且在数据段放写 ISN 的+1

发送完毕后，客户端进入 ESTABLISHED 状态，当服务器端接收到这个包时，也进入 ESTABLISHED 状态，TCP 握手结束

[![8NAjB9.md.jpg](https://s1.ax1x.com/2020/03/17/8NAjB9.md.jpg)](https://imgchr.com/i/8NAjB9)

四次挥手：

两个通道可以同时工作：客户端向服务端发送信号的同时服务端也可以向客户端发送信号。所以关闭双通道的时候就是这样：

客户端：我要关闭输入通道了。 服务端：好的，但还没有准备好关闭连接。

服务端：已准备关闭输入通道了。 客户端：好的你关闭吧，我也把这个通道关闭，等待两个最大段生命周期（2MSL）完全关闭。

[![8NAXnJ.md.jpg](https://s1.ax1x.com/2020/03/17/8NAXnJ.md.jpg)](https://imgchr.com/i/8NAXnJ)

## 为什么需要等待 2MSL 关闭就是安全的

因为在 client 发送出 ACK 之后，会遇到如下情况

- Clinet 到 Server 一次过程最多 1MSL
- Server 未收到 ACK，超过 Server 会自动重发 FIN；

两种情况加在一起最大时长为 2MSL

## rpc 协议和 tcp 协议的区别

| 协议 |                    特点                    |
| ---- | :----------------------------------------: |
| tcp  |               需要 DNS 寻址                |
|      |                  单工通信                  |
| rpc  | 二进制数据传输，更小的体积，更快编解码速率 |
|      |   不一定是 DNS 寻址，可能是内部服务寻址    |
|      |        单工/半双工/双工通信方式支持        |
| UDP  |                   不可靠                   |
|      |               支持广播和多播               |
|      |        无连接的，不需要握手会和挥手        |

## http 1.0 1.1 2.0 协议特性与区别

http 1.0

1. 无状态
需要 cookie/session 做身份认证和登录
2. 无连接

a. 每次连接结束都会关闭连接，再重新创建连接 tcp 三次连接与四次挥手，效率很低；

b. 在上一个请求到达结束之前无法发送下一个请求；

http 1.1

1. 长连接 keep-alive
2. 管道机制 不必等待上一个请求返回就能发送下一个请求，返回的结果还是按照顺序，但是为了保持响应顺序，还是存在队头阻塞问题；
3. 缓存 cache-control；
4. 断点传输

http 2.0

1. 二进制分帧；
2. 多路复用 在共享 TCP 链接的基础上同时发送请求和响应；
3. 头部压缩；
4. 服务器推送；

## 简单讲解一下 http2 的多路复用

http1.0 一个请求建立一个链接，请求结束就关闭，依次往复，可开启'keep-alive'，让链接不关闭复用

http1.1 默认允许一个连接发送多个请求，浏览器为了控制资源一般控制在 6 个左右，虽然建立多个连接，但需要等待前一个请求结束，服务器才会响应后面的请求；

http2 采用二进制传输数据，更高效，有两个非常重要的概念，帧和流，帧是最小数据单位，帧会标识属于哪个流，可以在一个连接中发送并行发送多个请求，避免了 1.1 中队头阻塞的问题，极大提高性能。

## https

特点

- http + ssl/tls
- 对称加密传输数据，非对称加密进行身份验证
- 443抵押不急于
- 需要ca证书
- RSA加密方式

https TLS/SSL握手过程

1. ClientHello 客户端发送请求，给出协议版本、随机数A和支持的加密算法；
2. SeverHello 服务端返回数据证书，并给出加密算法和随机数B；
3. 客户端校验证书，生成随机数C，通过之后使用证书中的公钥进行加密，加密数据和随机数C返回给服务端；
4. 服务端私钥解密，得到随机数C，比较随机数是否一致；
5. 建立传输通道，使用加密方法将三个随机数生成的对称密钥来通讯；
